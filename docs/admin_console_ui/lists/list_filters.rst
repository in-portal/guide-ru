Использование фильтров в списках
================================
`Data Source`_

Данная статья описывает набор доступных типов фильтров в системе для фильтрации данных в списках.
В абсолютном большинстве случаев их использование сводится к прописыванию типа фильтра, в конфигурационном
файле префикса, в параметре ``filter_block`` в ключе :ref:`uc_Grids` индивидуально для каждого поля.
Исключением является фильтр :ref:`gf_grid_picker_filter`, который применяется совместно с блоком
:ref:`inp_edit_picker <form_control_inp_edit_picker>` и классом
:doc:`EditPickerHelper </admin_console_ui/forms/editpickerhelper_class>`.

.. _grid_filter_description:

Описание фильтров
-----------------

+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| Изображение                                   | Название блока                    | Описание                                                           |
+===============================================+===================================+====================================================================+
| .. figure:: /images/Empty_filter.png          | .. config-property::              | Данный фильтр используется для тех полей, фильтрация данных в      |
|    :alt: Отсутствующий фильтр                 |    :name: grid_empty_filter       | которых не предусмотрена. Например, когда содержание поля          |
|                                               |    :ref_prefix: gf_               | формируется в шаблоне, в процессе распечатки списка.               |
|    Отсутствующий фильтр                       |                                   |                                                                    |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Like_filter.png           | .. config-property::              | | **Использование:** Поиск в текстовых полях.                      |
|    :alt: Фильтр списка типа LIKE              |    :name: grid_like_filter        | | **Возможные данные:** Произвольный текст с содержанием           |
|                                               |    :ref_prefix: gf_               |   специальных символов.                                            |
|    Фильтр списка типа LIKE                    |                                   | | **Что фильтрует:** Позволяет найти записи, которые содержат      |
|                                               |                                   |   либо любое из слов,                                              |
|                                               |                                   |   либо всю фразу целиком.                                          |
|                                               |                                   | | **Формат:** Запрос может быть составлен в следующих вариантах:   |
|                                               |                                   |                                                                    |
|                                               |                                   | - Строка, заключённая в двойные кавычки (пример: "Вася пупкин")    |
|                                               |                                   |   - ищет всю подстроку целиком.                                    |
|                                               |                                   | - Строка, не заключённая в двойные кавычки (пример: Вася пупкин)   |
|                                               |                                   |   - ищет любое из слов, заданных в строке.                         |
|                                               |                                   | - Строка в любом из выше перечисленном вариантах с содержанием     |
|                                               |                                   |   специальных символов, обозначающих: ``?`` - любой один символ,   |
|                                               |                                   |   ``%`` - любое количество любых символов.                         |
|                                               |                                   | - Символ ``+`` перед словом или словосочетанием, заключённым в     |
|                                               |                                   |   двойные кавычки, указывает на обязательное присутствие данного   |
|                                               |                                   |   слова или словосочетания в результатах.                          |
|                                               |                                   | - Символ ``-`` перед словом или словосочетанием, заключённым в     |
|                                               |                                   |   двойные кавычки, указывает на обязательное отсутствие данного    |
|                                               |                                   |   слова или словосочетания в результатах.                          |
|                                               |                                   |                                                                    |
|                                               |                                   | | **Форматтер:** Отсутствует.                                      |
|                                               |                                   | | **Ограничения:** Не возможно задать поиск по точному совпадению, |
|                                               |                                   |   т.к. ищет заданную комбинацию в любой части строки.              |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Like_filter.png           | .. config-property::              | | **Использование:** Поиск в текстовых полях c предложением        |
|    :alt: Фильтр списка типа LIKE с            |    :name: grid_like_combo_filter  |   вариантов из существующих значений при наборе критерия поиска.   |
|          подсказкой                           |    :ref_prefix: gf_               | | **Возможные данные:** Произвольный текст с содержанием           |
|                                               |                                   |   специальных символов.                                            |
|    Фильтр списка типа LIKE с                  |                                   | | **Что фильтрует:** Позволяет найти записи, которые содержат      |
|    подсказкой                                 |                                   |   либо любое из слов, либо всю фразу целиком.                      |
|                                               |                                   | | **Формат:** Запрос может быть составлен в следующих вариантах:   |
|                                               |                                   |                                                                    |
|                                               |                                   | - Строка, заключённая в двойные кавычки (пример: "Вася пупкин")    |
|                                               |                                   |   - ищет всю подстроку целиком                                     |
|                                               |                                   | - Строка, не заключённая в двойные кавычки (пример: Вася пупкин)   |
|                                               |                                   |   - ищет любое из слов, заданных в строке                          |
|                                               |                                   | - Строка в любом из выше перечисленном вариантах с содержанием     |
|                                               |                                   |   специальных символов, обозначающих: ``?`` - любой один символ,   |
|                                               |                                   |   ``%`` - любое количество любых символов                          |
|                                               |                                   | - Символ ``+`` перед словом или словосочетанием, заключённым в     |
|                                               |                                   |   двойные кавычки, указывает на обязательное присутствие данного   |
|                                               |                                   |   слова или словосочетания в результатах.                          |
|                                               |                                   | - Символ "-" перед словом или словосочетанием, заключённым в       |
|                                               |                                   |   двойные кавычки, указывает на обязательное отсутствие данного    |
|                                               |                                   |   слова или словосочетания в результатах.                          |
|                                               |                                   |                                                                    |
|                                               |                                   | | **Форматтер:** Отсутствует.                                      |
|                                               |                                   | | **Ограничения:** Не возможно задать поиск по точному             |
|                                               |                                   |   совпадению, т.к. ищет заданную комбинацию в любой части          |
|                                               |                                   |   строки.                                                          |
|                                               |                                   | | **Модифицирование поведения:** При подсказывании значений        |
|                                               |                                   |   вызывается событие :doc:`/events/general/on_suggest_values`      |
|                                               |                                   |   в котором происходит выборка значений для подсказки.             |
|                                               |                                   |   Переопределив данное событие в обработчике события можно         |
|                                               |                                   |   реализовать собственную логику подсказывания значений.           |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Options_filter.png        | .. config-property::              | | **Использование:** Поиск в полях с набором заданных значений.    |
|    :alt: Фильтр списка из опций               |    :name: grid_options_filter     | | **Возможные данные:** Набор заданных значений.                   |
|    :figwidth: 180px                           |    :ref_prefix: gf_               | | **Что фильтрует:** Позволяет найти записи с полем,               |
|    :width: 180px                              |                                   |   установленным в конкретное значение из набора возможных          |
|                                               |                                   |   значений.                                                        |
|    Фильтр списка из опций                     |                                   | | **Формат:** Выпадающий список с набором заданных значений.       |
|                                               |                                   | | **Форматтер:** :ref:`fmt_class_kOptionsFormatter` -              |
|                                               |                                   |   отвечает за формирование списка опций в выпадающем списке        |
|                                               |                                   |   фильтра.                                                         |
|                                               |                                   | | **Ограничения:** Только полное совпадение и только по одному     |
|                                               |                                   |   значению.                                                        |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Picker_filter.png         | .. config-property::              | | **Использование:** Поиск в полях для заполнения которых          |
|    :alt: Фильтр списка из опций типа          |    :name: grid_picker_filter      |   использовались блоки :ref:`form_control_inp_edit_picker`         |
|          Picker                               |    :ref_prefix: gf_               |   или :ref:`form_control_inp_edit_checkboxes`, а также полей,      |
|                                               |                                   |   данные в которых хранятся в виде ``|ID1|ID2|...|IDN|``.          |
|    Фильтр списка из опций типа Picker         |                                   | | **Возможные данные:** Набор заданных значений.                   |
|                                               |                                   | | **Что фильтрует:** Позволяет найти записи, содержащие            |
|                                               |                                   |   конкретное значение в установленном наборе значений.             |
|                                               |                                   | | **Формат:** Выпадающий список с набором заданных значений.       |
|                                               |                                   | | **Форматтер:** :ref:`fmt_class_kOptionsFormatter` -              |
|                                               |                                   |   отвечает за формирование списка опций в выпадающем списке        |
|                                               |                                   |   фильтра.                                                         |
|                                               |                                   | | **Ограничения:** Нельзя найти записи, которые содержат           |
|                                               |                                   |   только указанную опцию, т.е. поиск по полному совпадению         |
|                                               |                                   |   не возможен.                                                     |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Equals_filter.png         | .. config-property::              | | **Использование:** Поиск в полях с текстом либо числами.         |
|    :alt: Фильтр списка по точному             |    :name: grid_equals_filter      | | **Возможные данные:** Текст либо числа.                          |
|          совпадению                           |    :ref_prefix: gf_               | | **Что фильтрует:** Позволяет найти записи у которых              |
|                                               |                                   |   фильтруемое поле равно заданной строке или числу.                |
|    Фильтр списка по точному совпадению        |                                   | | **Формат:** Текстовая строка либо число.                         |
|                                               |                                   | | **Форматтер:** Отсутствует.                                      |
|                                               |                                   | | **Ограничения:** Только полное совпадение по конкретному         |
|                                               |                                   |    значению.                                                       |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Range_filter.png          | .. config-property::              | | **Использование:** Фильтрация полей с целыми числами.            |
|    :alt: Фильтр списка по целым числам        |    :name: grid_range_filter       | | **Возможные данные:** Целые числа.                               |
|          с фильтрацией по интервалу           |    :ref_prefix: gf_               | | **Что фильтрует:** Позволяет найти записи, где                   |
|                                               |                                   |   фильтруемое поле равно:                                          |
|    Фильтр списка по целым числам с            |                                   |                                                                    |
|    фильтрацией по интервалу                   |                                   | - Если введено значение только в одно из полей, то ищется          |
|                                               |                                   |   точное совпадение заданному значению.                            |
|                                               |                                   | - Если введены значения в оба поля, то ищутся значения,            |
|                                               |                                   |   попадающие в заданный интервал значений.                         |
|                                               |                                   |                                                                    |
|                                               |                                   | | **Формат:** Одно или два целых числа.                            |
|                                               |                                   | | **Форматтер:** Отсутствует.                                      |
|                                               |                                   | | **Ограничения:** Поиск только целых чисел.                       |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Range_float_filter.png    | .. config-property::              | | **Использование:** Фильтрация полей с дробными числами.          |
|    :alt: Фильтр списка по дробным числам с    |    :name: grid_float_range_filter | | **Возможные данные:** Дробные числа.                             |
|          фильтрацией по интервалу             |    :ref_prefix: gf_               | | **Что фильтрует:** Позволяет найти записи, где                   |
|                                               |                                   |   фильтруемое поле равно:                                          |
|    Фильтр списка по дробным числам с          |                                   |                                                                    |
|    фильтрацией по интервалу                   |                                   | - Если введено значение только в одно из полей, то ищется          |
|                                               |                                   |   точное совпадение заданному значению.                            |
|                                               |                                   | - Если введены значения в оба поля, то ищутся значения,            |
|                                               |                                   |   попадающие в заданный интервал значений.                         |
|                                               |                                   |                                                                    |
|                                               |                                   | | **Формат:** Одно или два дробных числа.                          |
|                                               |                                   | | **Форматтер:** Отсутствует.                                      |
|                                               |                                   | | **Ограничения:** Поиск только в полях с дробными числами.        |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+
| .. figure:: /images/Date_range_filter.png     | .. config-property::              | | **Использование:** Поиск в полях с датами.                       |
|    :alt: Фильтр списка по датам с фильтрацией |    :name: grid_date_range_filter  | | **Возможные данные:** Дата, время или дата с временем.           |
|          по интервалу                         |    :ref_prefix: gf_               | | **Что фильтрует:** Позволяет найти записи, где фильтруемое       |
|    :figwidth: 180px                           |                                   |   поле равно:                                                      |
|    :width: 180px                              |                                   |                                                                    |
|                                               |                                   | - Если введена дата только в одно из полей, то ищется точное       |
|    Фильтр списка по датам с фильтрацией по    |                                   |   совпадение дате.                                                 |
|    интервалу                                  |                                   | - Если введены даты в оба поля, то ищутся даты, попадающие в       |
|                                               |                                   |   заданный интервал.                                               |
|                                               |                                   |                                                                    |
|                                               |                                   | | **Формат:** Системный (опция :ref:`fmt_input_format` из          |
|                                               |                                   |   описания поля) либо переопределён пользователем (параметр        |
|                                               |                                   |   ``calendar_format`` указанный при добавлении поля в список).     |
|                                               |                                   |   Возможны только те форматы, которые обрабатывает форматтер       |
|                                               |                                   |   ``kDateFormatter``.                                              |
|                                               |                                   | | **Форматтер:** :ref:`fmt_class_kDateFormatter` - отвечает        |
|                                               |                                   |   за преобразование даты из внутреннего формата хранения в         |
|                                               |                                   |   заданный формат либо формат по умолчанию.                        |
|                                               |                                   | | **Ограничения:** Поиск только по полям, содержащими дату в       |
|                                               |                                   |   формате ``timestamp``.                                           |
+-----------------------------------------------+-----------------------------------+--------------------------------------------------------------------+

Конфигурационный файл
---------------------

Ниже приведён фрагмент :doc:`конфигурационного файла </components/unit_configs/config_files>`, в котором наглядно
продемонстрировано куда нужно писать название выше описанных :ref:`блоков фильтрации <grid_filter_description>`.

.. code:: php

   'Grids' => Array (
       'Default' => Array (
           'Icons' => Array ('default' => 'icon16_sample.gif'),
           'Fields' => Array (
               'ExampleId' => Array ('title' => 'la_col_Id', 'data_block' => 'grid_checkbox_td', 'filter_block' => 'grid_range_filter'),
               'ExampleName' => Array ('title' => 'la_col_ExampleName', 'filter_block' => 'grid_like_filter'),
               'ExampleAmount' => Array ('title' => 'la_col_ExampleAmount', 'filter_block' => 'grid_range_filter'),
               'ExampleSum' => Array ('title' => 'la_col_ExampleSum', 'filter_block' => 'grid_float_range_filter'),
               'ExampleDate' => Array ('title' => 'la_col_ExampleDate', 'filter_block' => 'grid_date_range_filter'),
               'ExampleEditPicker' => Array ('title' => 'la_col_ExampleEditPicker', 'data_block' => 'grid_picker_td', 'filter_block' => 'grid_options_filter'),
           ),
       ),
   ),

+------------------------+---------------------------------------------------------------------------------------+
| параметр               | описание параметра                                                                    |
+========================+=======================================================================================+
| .. config-property::   | Задаёт тип используемого фильтра. По умолчанию используется ``grid_column_filter``,   |
|    :name: filter_block | который вызывает :ref:`gf_grid_like_filter`.                                          |
|    :type: string       |                                                                                       |
+------------------------+---------------------------------------------------------------------------------------+
| .. config-property::   | Задаёт блок, который используется для показывания данных в списке. На данный момент   |
|    :name: data_block   | доступно 2 блока, названия которых можно указать в этом параметре:                    |
|    :type: string       |                                                                                       |
|                        | - ``grid_data_td`` - блок, который просто выводит отформатированное значение из поля  |
|                        |   (используется по умолчанию, если данный параметр не указан);                        |
|                        |                                                                                       |
|                        | .. versionadded:: 5.0.0                                                               |
|                        |                                                                                       |
|                        | - ``grid_priority_td`` - блок, в котором помимо отформатированного значения из поля   |
|                        |   также выводиться значение поля ``Priority`` (eсли значение в поле ``Priority``      |
|                        |   равняется нулю (``0``), то оно показано не будет).                                  |
+------------------------+---------------------------------------------------------------------------------------+

.. _Data Source: http://guide.in-portal.org/rus/index.php/K4:%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%BE%D0%B2_%D0%B2_%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%D1%85
