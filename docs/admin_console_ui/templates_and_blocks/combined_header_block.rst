Работа с блоком "combined header"
=================================
`Data Source`_

Блок ``combined_header`` используется для формирования заголовка шаблонов, напр. форм редактирования
и выполняет следующие функции:

- проверка права доступа к операциям над элементами (``view``, ``add``, ``edit``, ``delete``);
- подключение шаблона с описанием вкладок (``tabs``);
- подключение элемента, показывающего номера страниц (``pagination``);
- установку заголовка окна (``title``).

Обрабатываемые параметры
------------------------

+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| параметр                                | описание                                                                                      |
+=========================================+===============================================================================================+
| .. config-property::                    | Параметр указывает на необходимость выведения нумерации страниц в ``bluebar``.                |
|    :name: pagination                    | Используется только на списках. Не работает на списках подчинённых                            |
|    :type: int                           | :ref:`префиксов <uc_Prefix>`.                                                                 |
|    :ref_prefix: element_ch_             |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | .. versionadded:: 5.0.0                                                                       |
|    :name: pagination_prefix             |                                                                                               |
|    :type: int                           | Данный параметр позволяет задать префикс, который должен использоваться для                   |
|    :ref_prefix: element_ch_             | выведения нумерации страниц в ``bluebar``. Если данный параметр не указан,                    |
|                                         | то в качестве него будет использовано значение параметра :ref:`element_ch_prefix`.            |
|                                         | Обычно он используется при выводе списков подчинённых записей.                                |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | Параметр :ref:`uc_PermSection` из :doc:`конфигa </components/unit_configs/config_files>`      |
|    :name: perm_section                  | отображаемого элемента или списка элементов, идентифицирует                                   |
|    :type: string                        | :doc:`секцию </admin_console_ui/templates_and_blocks/tree_sections>`, чтобы можно             |
|    :ref_prefix: element_ch_             | было применить к ней :doc:`систему прав доступа </components/using_permissions>`. Будет       |
|                                         | определён автоматически, если параметр не передан.                                            |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | Параметр указывает на то, какие права необходимы для получения доступа                        |
|    :name: permission_type               | (``view``, ``add``, ``edit``, ``delete``). Если параметр не передан,                          |
|    :type: string                        | по умолчанию проверяется право ``view``.                                                      |
|    :ref_prefix: element_ch_             |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | .. versionadded:: 5.0.0                                                                       |
|    :name: perm_prefix                   |                                                                                               |
|    :type: string                        | Данный параметр позволяет указать префикс, по объекту которого будет получена                 |
|    :ref_prefix: element_ch_             | :doc:`категория </database/table_structure/category>` для проверки                            |
|                                         | :ref:`прав доступа <tag_cp_perm_prefix>` к используемому на шаблоне объекту.                  |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | .. versionadded:: 5.0.0                                                                       |
|    :name: perm_event                    |                                                                                               |
|    :type: string                        | Название :doc:`события </events>`, наличие :doc:`права </components/using_permissions>`       |
|    :ref_prefix: element_ch_             | вызова которого требуется проверить. Событие задаётся в форме ``prefix_special:EventName``,   |
|                                         | напр. ``phone:OnChangePrice``.                                                                |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | :ref:`Префикс <uc_Prefix>` отображаемого элемента или списка элементов.                       |
|    :name: prefix                        | В качестве значения данного параметра для подчинённых префиксов необходимо                    |
|    :type: string                        | использовать :ref:`префикс <uc_Prefix>` главного.                                             |
|    :ref_prefix: element_ch_             |                                                                                               |
|    :required: true                      |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | Название списка, который показывается на шаблоне (т.е. название ключа в опции :ref:`uc_Grids` |
|    :name: grid                          | в :doc:`unit config </components/unit_configs/config_files>`). Применяется только на          |
|    :type: string                        | шаблонах со списком.                                                                          |
|    :ref_prefix: element_ch_             |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | Используемая :doc:`секция </admin_console_ui/templates_and_blocks/tree_sections>`, которой    |
|    :name: section                       | принадлежит элемент или список элементов. Используется для отображения пиктограмм и названия  |
|    :type: string                        | раздела над списком элементов, а так же для проверки прав доступа.                            |
|    :ref_prefix: element_ch_             |                                                                                               |
|    :required: true                      |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | Параметр указывает на необходимость подключить шаблон вкладок (переданное                     |
|    :name: tabs                          | значение - название и путь к шаблону).                                                        |
|    :type: string                        |                                                                                               |
|    :ref_prefix: element_ch_             |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | В :doc:`конфиге </components/unit_configs/config_files>` используемого префикса               |
|    :name: tab_preset                    | (ключ :ref:`uc_EditTabPresets`) можно указать несколько наборов предопределённых              |
|    :type: string                        | вкладок, с помощью этого параметра можно указать какой из наборов надо использовать.          |
|    :ref_prefix: element_ch_             |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | Указывает на то, какой из заголовков, описанных в конфиге, необходимо использовать            |
|    :name: title_preset                  | в ``bluebar``.                                                                                |
|    :type: string                        |                                                                                               |
|    :ref_prefix: element_ch_             |                                                                                               |
|    :required: true                      |                                                                                               |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | .. versionadded:: 5.0.0                                                                       |
|    :name: additional_blue_bar_render_as |                                                                                               |
|    :type: string                        | Данный параметр позволяет указать название блока, который нужно показывать в правой           |
|    :ref_prefix: element_ch_             | части ``bluebar`` вместо ``pagination bar``. Если требуется оставить                          |
|                                         | ``pagionation bar`` и показать что-либо слева от него, то можно воспользоваться ниже          |
|                                         | показанным примером.                                                                          |
|                                         |                                                                                               |
|                                         | .. code:: html                                                                                |
|                                         |                                                                                               |
|                                         |    <inp2:m_DefineElement name="right_bluebar_element">                                        |
|                                         |        custom content                                                                         |
|                                         |                                                                                               |
|                                         |        <inp2:m_if check="m_Param" name="pagination">                                          |
|                                         |            <inp2:m_RenderElement name="grid_pagination_elem"                                  |
|                                         |                PrefixSpecial="$prefix"                                                        |
|                                         |                pass_params="1"                                                                |
|                                         |            />                                                                                 |
|                                         |        </inp2:m_if>                                                                           |
|                                         |    </inp2:m_DefineElement>                                                                    |
|                                         |                                                                                               |
|                                         |    <inp2:m_RenderElement name="combined_header"                                               |
|                                         |        prefix="sample-prefix"                                                                 |
|                                         |        section="custom:sample_section"                                                        |
|                                         |        title_preset="sample_list"                                                             |
|                                         |        additional_blue_bar_render_as="right_bluebar_element"                                  |
|                                         |    />                                                                                         |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | .. versionadded:: 5.0.0                                                                       |
|    :name: additional_title_render_as    |                                                                                               |
|    :type: string                        | Данный параметр позволяет указать название блока, который будет показан справа от             |
|    :ref_prefix: element_ch_             | крупного названия секции (того, что написано рядом с пиктограммой).                           |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+
| .. config-property::                    | .. versionadded:: 5.0.0                                                                       |
|    :name: parent                        |                                                                                               |
|    :type: int                           | Если указать данный параметр, то пиктограмма и большое название будут браться из              |
|    :ref_prefix: element_ch_             | родительской секции, а не той, что указана в параметре :ref:`element_ch_section`.             |
|                                         | В независимости от значения данного параметра на ``blue bar`` будет показана                  |
|                                         | информация от указанной в параметре :ref:`element_ch_section` секции. Данный                  |
|                                         | параметр по умолчанию включён.                                                                |
+-----------------------------------------+-----------------------------------------------------------------------------------------------+

.. note::

   ``*`` - параметр обязателен.

.. _combined_header_edit_tab_presets:

Шаблоны вкладок
---------------

Шаблоны вкладок задаются при помощи опции :ref:`uc_EditTabPresets` в unit config:

.. code:: php

   'EditTabPresets' => Array (
       'Default' => Array (
           Array ('title' => 'la_tab_General', 't' => 'in-portal/users/users_edit',        'priority' => 1),
           Array ('title' => 'la_tab_Groups',  't' => 'in-portal/users/users_edit_groups', 'priority' => 2),
           Array ('title' => 'la_tab_Images',  't' => 'in-portal/users/user_edit_images',  'priority' => 3),
           Array ('title' => 'la_tab_Custom',  't' => 'in-portal/users/users_edit_custom', 'priority' => 4),
       ),
       'Custom' => Array (
           ...
       ),
       'Test' => Array (
           ...
       ),
       ...
   ),

Именно значение одного из ключей верхнего уровня требуется указывать в качестве значения параметра
:ref:`element_ch_tab_preset` блоку ``combined_header``. Как видно из выше приведённого примере
описание самого tab preset является массивом, в каждый элемент которого описывает одну вкладку:

============ ============================================================================
название     описание
============ ============================================================================
``title``    Фраза, перевод которой будет показан в качестве названия вкладки в браузере.
``t``        Путь к шаблону, содержащему тело вкладки.
``priority`` Порядок вкладки относительно остальных вкладок данного tab preset.
============ ============================================================================

Использование
-------------

На списке
^^^^^^^^^

.. figure:: /images/Combined_header_sample_list.png
   :figwidth: 180px
   :width: 180px
   :align: left
   :alt: Результат использования тэга combined_header на списке

   Результат использования тэга combined_header на списке

.. code:: html

   <inp2:m_include t="incs/header" />
   <inp2:m_RenderElement name="combined_header" section="custom:tracking" prefix="tracking" pagination="1" />

.. clear-float::

На форме редактирования
^^^^^^^^^^^^^^^^^^^^^^^

.. figure:: /images/Combined_header_sample_edit.png
   :figwidth: 180px
   :width: 180px
   :align: left
   :alt: Результат использования тэга combined_header на странице редактирования

   Результат использования тэга combined_header на странице редактирования

.. code:: html

   <inp2:m_include t="incs/header"/>
   <inp2:m_RenderElement name="combined_header" section="custom:tracking" prefix="tracking" title_preset="tracking_edit"/>

.. clear-float::

В обоих примерах можно видеть действие параметра :ref:`element_ch_title_preset` (надпись на синем фоне),
а так же параметра :ref:`element_ch_section` - с его помощью во время обработки тэга можно определить
значение некоторых параметров, если они не были переданы. К таким относятся :ref:`element_ch_prefix` и
:ref:`element_ch_perm_section`. Так же с помощью параметра :ref:`element_ch_section` определяется
необходимая пиктограмма и название родительской секции, в которой находится данная секция.

.. _Data Source: http://guide.in-portal.org/rus/index.php/K4:%D0%A0%D0%B0%D0%B1%D0%BE%D1%82%D0%B0_%D1%81_%D0%B1%D0%BB%D0%BE%D0%BA%D0%BE%D0%BC_%22combined_header%22
